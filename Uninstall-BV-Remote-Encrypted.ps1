#=============================================================================
# CHIRRI RDS Deployment - Encrypted Script
# This script requires a password to execute
#=============================================================================

$ErrorActionPreference = "Stop"

function ConvertFrom-EncryptedPayload {
    param(
        [Parameter(Mandatory)][string]$EncryptedBase64,
        [Parameter(Mandatory)][SecureString]$Password
    )
    
    $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($Password)
    $passwordPlain = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)
    [System.Runtime.InteropServices.Marshal]::ZeroFreeBSTR($BSTR)
    
    $combined = [Convert]::FromBase64String($EncryptedBase64)
    
    $salt = New-Object byte[] 32
    $iv = New-Object byte[] 16
    $encryptedBytes = New-Object byte[] ($combined.Length - 48)
    
    [Array]::Copy($combined, 0, $salt, 0, 32)
    [Array]::Copy($combined, 32, $iv, 0, 16)
    [Array]::Copy($combined, 48, $encryptedBytes, 0, $encryptedBytes.Length)
    
    $keyDerivation = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
        $passwordPlain, 
        $salt, 
        100000,
        [System.Security.Cryptography.HashAlgorithmName]::SHA256
    )
    $key = $keyDerivation.GetBytes(32)
    $keyDerivation.Dispose()
    
    $passwordPlain = $null
    [System.GC]::Collect()
    
    $aes = [System.Security.Cryptography.Aes]::Create()
    $aes.Key = $key
    $aes.IV = $iv
    $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
    $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
    
    $decryptor = $aes.CreateDecryptor()
    $decryptedBytes = $decryptor.TransformFinalBlock($encryptedBytes, 0, $encryptedBytes.Length)
    
    $aes.Dispose()
    
    return [System.Text.Encoding]::UTF8.GetString($decryptedBytes)
}

# Encrypted payload
$encryptedPayload = "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"

# Prompt for password
Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host " CHIRRI BV Remote Desktop Setup" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""
$securePassword = Read-Host "Enter setup password" -AsSecureString

# Attempt decryption and execution
try {
    $decryptedScript = ConvertFrom-EncryptedPayload -EncryptedBase64 $encryptedPayload -Password $securePassword
    Invoke-Expression $decryptedScript
}
catch {
    Write-Host ""
    Write-Host "ERROR: Invalid password or corrupted data." -ForegroundColor Red
    Write-Host ""
    Write-Host "If you believe this is an error, contact IT support." -ForegroundColor Yellow
    Write-Host ""
    exit 1
}

